defmodule JSONRPC2.Response.BlockTest do
  use ExUnit.Case, async: true

  alias JSONRPC2.Response.Block
  alias JSONRPC2.TestFactory

  describe "new/1" do
    test "creates response block from internal block" do
      internal_block = TestFactory.build(:block)

      response_block = Block.new(internal_block)

      assert response_block == %Block{
               extraData: "",
               hash: "0x0000000000000000000000000000000000000000000000000000000000000010",
               logsBloom:
                 "0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
               miner: "0x0000000000000000000000000000000000000010",
               nonce: "0x0000000000000000",
               parentHash: "0x0000000000000000000000000000000000000000000000000000000000000010",
               receiptsRoot: "0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421",
               sha3Uncles: "0x0000000000000000000000000000000000000000000000000000000000000010",
               stateRoot: "0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421",
               transactions: [],
               transactionsRoot:
                 "0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421",
               uncles: [],
               difficulty: "0x01",
               gasLimit: "0x00",
               gasUsed: "0x00",
               number: "0x01",
               size: "0x00",
               timestamp: "0x01",
               totalDifficulty: "0x00"
             }
    end

    test "correctly encodes to json" do
      internal_block = TestFactory.build(:block)

      json_block =
        internal_block
        |> Block.new()
        |> Jason.encode!()

      assert json_block ==
               "{\"difficulty\":\"0x01\",\"extraData\":\"\",\"gasLimit\":\"0x00\",\"gasUsed\":\"0x00\",\"hash\":\"0x0000000000000000000000000000000000000000000000000000000000000010\",\"logsBloom\":\"0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\",\"miner\":\"0x0000000000000000000000000000000000000010\",\"nonce\":\"0x0000000000000000\",\"number\":\"0x01\",\"parentHash\":\"0x0000000000000000000000000000000000000000000000000000000000000010\",\"receiptsRoot\":\"0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421\",\"sha3Uncles\":\"0x0000000000000000000000000000000000000000000000000000000000000010\",\"size\":\"0x00\",\"stateRoot\":\"0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421\",\"timestamp\":\"0x01\",\"totalDifficulty\":\"0x00\",\"transactions\":[],\"transactionsRoot\":\"0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421\",\"uncles\":[]}"
    end
  end
end
